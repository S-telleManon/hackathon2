<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alljobs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/src/style.css">
    <link rel="stylesheet" href="index.html">
    <link rel="stylesheet" href="appliedjobs.html">    
        <style>
        body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #cccccc;
        }
        body::before {
        content: "";
        position: fixed; 
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url(./src/img/pexels-artempodrez-6990470.jpg) no-repeat center center/cover;
        opacity: 0.5; 
        z-index: -1; 
        }
        </style>
</head>

<body>
        <!-- -----------------------Navbar Section -------------------- -->
 <nav class="navbar navbar-expand-lg navbar-dark text-dark py-2">
  <div class="container-fluid">
    <div class="header_logocontainer">
      <div class="headerimg">
        <a href="index.html">
          <img src="./src/img/job.jpg" class="job_logo" width="60px" height="60px" alt="">
        </a>
      </div>
    </div>
    <div class="navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Browse Jobs
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
            <li><a class="dropdown-item" href="jobs.html?category_id=1">Hospitality/Travel</a></li>
            <li><a class="dropdown-item" href="jobs.html?category_id=2">Agriculture/Fishing</a></li>
            <li><a class="dropdown-item" href="jobs.html?category_id=3">Logistics/Courier</a></li>
            <li><a class="dropdown-item" href="jobs.html?category_id=4">Finance/Accounting</a></li>
            <li><a class="dropdown-item" href="jobs.html?category_id=5">Administrative/Clerical</a></li>
            <li><a class="dropdown-item" href="jobs.html?category_id=6">Marketing/Advertising</a></li>
            <li><a class="dropdown-item" href="jobs.html?category_id=7">Construction/Architecture</a></li>
            <li><a class="dropdown-item" href="jobs.html?category_id=8">Management</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="jobs.html">View all categories</a></li>
          </ul>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="appliedjobs.html">Applied Jobs</a>
        </li>
                <li class="nav-item">
                  <a class="nav-link" href="register.html">Register</a>
                </li>
       
        <li class="nav-item" id="navbarUserStatus" style="display:none;">
          <span class="nav-link" id="navbarStatus"></span>
        </li>

        
        <li class="nav-item">
          <a class="nav-link" href="login.html" id="navbarLoginBtn">Login</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
<!-- -----------------------Search Bar Section -------------------- -->
    <section id="searchbar">
        <div class="bckform1">
            <form class="d-flex justify-content-center" onsubmit="return false;"> <!-- prevent form submit -->
                <input class="form-control text-center  me-5" id="jobSearch" type="text" placeholder="Search by Job or Company or Location" aria-label="Search">
            </form>
        </div>

<!-- /*--------Jobs--------------*/ -->

    <section class="container my-5">
        <h2 class="mb-4" id="headerApplication">JOBS YOU APPLIED FOR:</h2>
        <div id="applied-jobs-container"></div>
    </section>
</body>
<script>
window.onload = function() {
    const container = document.getElementById("applied-jobs-container");

    // Check login
    fetch("/api/check-login")
        .then(res => res.json())
        .then(data => {
            if (!data.loggedIn) {
                alert("Please login to view your applied jobs");
                window.location.href = "/login.html";
                return;
            }

            // Fetch applied jobs
            fetch("/api/applied-jobs")
            .then(res => res.json())
            .then(data => {
                const jobs = data.jobs; // <-- fix here
                if (!jobs || jobs.length === 0) {
                    container.innerHTML = `<p style="color: green; font-weight: bold; font-size: 20px;">You have not applied for any jobs yet.</p>`;
                    return;
                }

                jobs.forEach(job => {
                    const jobDiv = document.createElement("div");
                    jobDiv.classList.add("wholejob", "mb-3");
                    jobDiv.innerHTML = `
                        <div class="joblisting">
                            <div class="headermain">${job.title}</div>
                            <div class="headersub3">${job.company_name ?? "Unknown Company"}</div>
                        </div>
                        <div class="jobdetails">
                            <div class="amount">${job.salary}</div>
                            <div class="dateadded"><i class="bi bi-alarm"></i><b>Added</b> ${new Date(job.published_date).toLocaleDateString('en-GB')}</div>
                            <div class="region"><i class="bi bi-geo-alt"></i>${job.location}</div>
                            <div class="deadline"><i class="bi bi-alarm"></i><b>Deadline</b> ${new Date(job.deadline).toLocaleDateString('en-GB')}</div>
                        </div>
                        <div class="buttonsubmit">

                            <div class="cvbtn1">
                                <button type="button" class="btn btn-dark view-btn" data-job-id="${job.id}">View Job <i class="bi bi-eye"></i></button>
                            </div>
                        </div>
                    `;
                    container.appendChild(jobDiv);

                    // View Job click
                    jobDiv.querySelector('.view-btn').addEventListener('click', (e) => {
                        const jobId = e.currentTarget.getAttribute('data-job-id');
                        window.location.href = `jobdetails.html?id=${jobId}`;
                    });
                });
            })
            .catch(err => {
                console.error("Error fetching applied jobs:", err);
                container.innerHTML = `<p style="color:red;">Error loading applied jobs</p>`;
            });
                });
};
</script>
<script src="login.js"></script>
</body>
</html>
